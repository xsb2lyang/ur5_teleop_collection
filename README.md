# UR5 æœºå™¨äººé¥æ“ä½œä¸å¤šæ¨¡æ€æ•°æ®é‡‡é›†å¹³å°

æœ¬é¡¹ç›®æä¾›äº†ä¸€å¥—å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œç”¨äºé€šè¿‡Xboxæ‰‹æŸ„å®æ—¶é¥æ“ä½œUR5/UR5eæœºæ¢°è‡‚ï¼Œå¹¶åŒæ­¥é‡‡é›†æ¥è‡ªæœºæ¢°è‡‚æœ¬ä½“ã€RobotiqäºŒæŒ‡å¤¹çˆªä»¥åŠä¸¤ä¸ªå¼‚æ„ç›¸æœºï¼ˆIntel RealSense D435, Stereolabs ZED 2iï¼‰çš„å¤šæ¨¡æ€æ•°æ®ã€‚

è¯¥å¹³å°ä¸“ä¸ºæœºå™¨äººå­¦ä¹ é¢†åŸŸçš„æ•°æ®é›†é‡‡é›†è€Œè®¾è®¡ï¼Œæ”¯æŒâ€œå¼€å§‹-åœæ­¢â€å¼çš„è¿ç»­æ•°æ®å½•åˆ¶ï¼Œå¹¶å°†æ•°æ®ä»¥å¯¹æœºå™¨å­¦ä¹ å‹å¥½çš„æ ¼å¼è¿›è¡Œä¿å­˜ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

- **å®æ—¶é¥æ“ä½œ**ï¼šé€šè¿‡Xboxæ‰‹æŸ„å¯¹UR5æœºæ¢°è‡‚è¿›è¡Œä½å»¶è¿Ÿã€ç›´è§‚çš„6è‡ªç”±åº¦è¿åŠ¨æ§åˆ¶ã€‚
- **å¤šæ¨¡æ€æ•°æ®åŒæ­¥**ï¼šåœ¨é¥æ“ä½œçš„åŒæ—¶ï¼ŒåŒæ­¥è®°å½•ä»¥ä¸‹æ•°æ®æµï¼š
    - **æœºæ¢°è‡‚çŠ¶æ€**ï¼šTCPï¼ˆå·¥å…·ä¸­å¿ƒç‚¹ï¼‰çš„6Dä½å§¿ï¼ˆX, Y, Z, Rx, Ry, Rzï¼‰ã€‚
    - **å¤¹çˆªçŠ¶æ€**ï¼šRobotiqäºŒæŒ‡å¤¹çˆªçš„å¼€åˆçŠ¶æ€ï¼ˆ1 for open, 0 for closedï¼‰ã€‚
    - **D435ç›¸æœº**ï¼šRGBå½©è‰²å›¾åƒå’Œ16ä½åŸå§‹æ·±åº¦å›¾åƒã€‚
    - **ZED 2iç›¸æœº**ï¼šRGBå½©è‰²å›¾åƒã€‚
- **è¿ç»­æ•°æ®é‡‡é›†**ï¼š
    - ä½¿ç”¨æ‰‹æŸ„ `Start` é”®å¼€å§‹ä¸€ä¸ªé‡‡é›†ä¼šè¯ã€‚
    - åœ¨ä¼šè¯æœŸé—´ï¼Œä»¥é¢„è®¾é¢‘ç‡ï¼ˆé»˜è®¤ä¸º10Hzï¼‰è¿ç»­è®°å½•æ•°æ®ã€‚
    - ä½¿ç”¨æ‰‹æŸ„ `Back` é”®ç»“æŸä¼šè¯ï¼Œå¹¶å°†æ‰€æœ‰æ•°æ®ä¸€æ¬¡æ€§ä¿å­˜ã€‚
- **å‹å¥½çš„æ•°æ®æ ¼å¼**ï¼š
    - æœºæ¢°è‡‚å’Œå¤¹çˆªçŠ¶æ€è¢«æ•´åˆä¸ºä¸€ä¸ª `N x 7` çš„NumPyæ•°ç»„ï¼Œå¹¶ä¿å­˜ä¸º `robot_state.npy` æ–‡ä»¶ã€‚
    - æ‰€æœ‰å›¾åƒå‡ä»¥æ—¶é—´æˆ³å‘½åï¼Œä¿å­˜ä¸º `.png` æ ¼å¼ï¼Œæ˜“äºå’Œ `.npy` æ–‡ä»¶ä¸­çš„æ•°æ®å¯¹é½ã€‚
- **æ¨¡å—åŒ–ä¸å¤šçº¿ç¨‹æ¶æ„**ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œé‡‡ç”¨å¤šçº¿ç¨‹åˆ†ç¦»IOã€è¿åŠ¨æ§åˆ¶å’Œæ•°æ®é‡‡é›†ï¼Œç¡®ä¿ç³»ç»Ÿæ€§èƒ½å’Œç¨³å®šæ€§ã€‚

## ğŸ› ï¸ ç¯å¢ƒä¾èµ–

### ç¡¬ä»¶ (Hardware)
- UR5 æˆ– UR5e æœºæ¢°è‡‚
- Robotiq 2F-85 äºŒæŒ‡å¤¹çˆª
- æ ‡å‡† Xbox æ§åˆ¶å™¨
- Intel RealSense D435 æ·±åº¦ç›¸æœº
- Stereolabs ZED 2i æ·±åº¦ç›¸æœº
- ä¸€å°è¿æ¥ä»¥ä¸Šæ‰€æœ‰è®¾å¤‡çš„Linuxå·¥ä½œç«™ï¼ˆæœ¬äººé‡‡ç”¨Ubuntu 22.04ï¼‰

### è½¯ä»¶ (Software)
- Python (>= 3.8)
- **ZED SDK**: è¯·ä» [Stereolabså®˜ç½‘](https://www.stereolabs.com/developers/release/) ä¸‹è½½å¹¶å®‰è£…ã€‚
- **Python ä¾èµ–åº“**:
  åˆ›å»ºä¸€ä¸ªåä¸º `requirements.txt` çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼Œç„¶åé€šè¿‡ `pip install -r requirements.txt` å®‰è£…ã€‚

  ```txt
  ur-rtde
  inputs
  pyrealsense2
  pyzed
  numpy
  opencv-python
  psutil
  ```

## ğŸš€ å®‰è£…ä¸é…ç½®

1.  **å…‹éš†é¡¹ç›®**
    ```bash
    git clone [æ‚¨çš„é¡¹ç›®ä»“åº“åœ°å€]
    cd [é¡¹ç›®æ–‡ä»¶å¤¹]
    ```

2.  **å®‰è£…ZED SDK**
    è¯·åŠ¡å¿…å…ˆå®‰è£…ä¸æ‚¨CUDAç‰ˆæœ¬åŒ¹é…çš„ZED SDKï¼Œå¹¶æ ¹æ®æŒ‡å¼•å®ŒæˆPython APIçš„å®‰è£…ã€‚

3.  **é…ç½®æœºå™¨äººIPåœ°å€ (é‡è¦!)**
    æ‰“å¼€ `src/ur5_control/ur5_controller.py` æ–‡ä»¶ï¼Œä¿®æ”¹ `UR5Controller` åˆå§‹åŒ–æ—¶çš„ `robot_ip` å‚æ•°ä¸ºæ‚¨æœºæ¢°è‡‚çš„å®é™…IPåœ°å€ã€‚
    ```python
    # line 27 in ur5_controller.py
    def __init__(self, robot_ip="192.168.192.7", ...): # <-- ä¿®æ”¹æ­¤å¤„çš„IPåœ°å€
    ```

4.  **å®‰è£…Pythonä¾èµ–**
    ```bash
    pip install -r requirements.txt
    ```

## â–¶ï¸ è¿è¡Œç¨‹åº

**å¯åŠ¨ç¨‹åº**: ç¡®ä¿æ‰€æœ‰ç¡¬ä»¶ï¼ˆæœºæ¢°è‡‚ã€ç›¸æœºã€æ‰‹æŸ„ï¼‰å·²è¿æ¥å¹¶ä¸Šç”µã€‚è¿›å…¥ `src` ç›®å½•ï¼Œåœ¨ç»ˆç«¯ä¸­è¿è¡Œä¸»ç¨‹åºï¼Œç”±äºç¨‹åºéœ€è¦è®¾ç½®å®æ—¶ç³»ç»Ÿä¼˜å…ˆçº§å¹¶è®¿é—®åº•å±‚ç¡¬ä»¶ï¼Œæ¨èä½¿ç”¨ `sudo` æ¥è¿è¡Œï¼š

```bash
cd src
# è¿™ä¸ªå‘½ä»¤ä¼šä½¿ç”¨sudoæ¥è·å–æƒé™ï¼ŒåŒæ—¶ç¡®ä¿è¿è¡Œçš„æ˜¯å½“å‰æ¿€æ´»çš„Pythonè™šæ‹Ÿç¯å¢ƒ
sudo $(which python) main.py
```

ç¨‹åºå¯åŠ¨åï¼Œä¼šåˆå§‹åŒ–æ‰€æœ‰è®¾å¤‡ï¼Œå¹¶ç­‰å¾…æ‚¨çš„æ“ä½œæŒ‡ä»¤ã€‚

## ğŸ“‹ é‡‡é›†æµç¨‹
---
æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ¥å®Œæˆä¸€ä¸ªå®Œæ•´çš„ä»»åŠ¡æ ·æœ¬é‡‡é›†ï¼š

1. **ä»»åŠ¡å‡†å¤‡**: ç¨‹åºå¯åŠ¨åï¼Œå¯ä»¥é€šè¿‡æ‰‹æŸ„å°†æœºæ¢°è‡‚ç§»åŠ¨åˆ°ä¸€ä¸ªåˆé€‚çš„èµ·å§‹ä½ç½®ï¼Œå‡†å¤‡å¼€å§‹æ‰§è¡Œæ“ä½œä»»åŠ¡ã€‚
    
2. **å¼€å§‹å½•åˆ¶**: å½“ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œ**æŒ‰ä¸€ä¸‹æ‰‹æŸ„ä¸Šçš„ `Start` é”®**ã€‚ç»ˆç«¯ä¼šæç¤ºâ€œå½•åˆ¶å¼€å§‹...â€ï¼Œç¨‹åºä¼šä»¥çº¦10Hzçš„é¢‘ç‡åœ¨åå°è®°å½•æ‰€æœ‰æ•°æ®æµã€‚
    
3. **æ‰§è¡Œä»»åŠ¡**: åœ¨å½•åˆ¶çŠ¶æ€ä¸‹ï¼Œä½¿ç”¨æ‰‹æŸ„é¥æ“ä½œæœºæ¢°è‡‚å’Œå¤¹çˆªï¼Œå®Œæˆä¸€ä¸ªå®Œæ•´çš„æ“ä½œä»»åŠ¡ï¼ˆä¾‹å¦‚ï¼šä»Aç‚¹æŠ“å–ä¸€ä¸ªç‰©ä½“å¹¶ç§»åŠ¨åˆ°Bç‚¹ï¼‰ã€‚
    
4. **ç»“æŸå¹¶ä¿å­˜**: ä»»åŠ¡å®Œæˆåï¼Œ**æŒ‰ä¸€ä¸‹æ‰‹æŸ„ä¸Šçš„ `Back` é”®**ã€‚å½•åˆ¶ä¼šç«‹å³åœæ­¢ï¼Œç¨‹åºä¼šè‡ªåŠ¨å¤„ç†å¹¶ä¿å­˜è¿™æ®µæ—¶é—´é‡‡é›†åˆ°çš„æ‰€æœ‰æ•°æ®ã€‚ç»ˆç«¯ä¼šæ˜¾ç¤ºâ€œæ•°æ®ä¿å­˜å®Œæ¯•ï¼â€çš„æ¶ˆæ¯ã€‚
    
5. **é‡å¤æˆ–é€€å‡º**: æ‚¨å¯ä»¥é‡å¤ç¬¬2æ­¥è‡³ç¬¬5æ­¥æ¥é‡‡é›†å¤šä¸ªä¸åŒçš„ä»»åŠ¡æ ·æœ¬ã€‚å…¨éƒ¨ä»»åŠ¡ç»“æŸåï¼Œåœ¨ç»ˆç«¯æŒ‰ `Ctrl+C` å³å¯å®‰å…¨é€€å‡ºç¨‹åºã€‚

## ğŸ® æ“ä½œæŒ‡å—
![[xbox.jpg]]

| æ§åˆ¶åŠŸèƒ½ | æŒ‰é”® / æ‘‡æ† |
| :--- | :--- |
| **è¿åŠ¨æ§åˆ¶** | |
| å‰å / å·¦å³ç§»åŠ¨ | `å·¦æ‘‡æ†` |
| ä¸Šä¸‹ç§»åŠ¨ | `å³æ‰³æœº (RT)` / `å·¦æ‰³æœº (LT)` |
| å·¥å…·å§¿æ€æ—‹è½¬ (Roll/Pitch) | `å³æ‘‡æ†` |
| å·¥å…·å§¿æ€æ—‹è½¬ (Yaw) | `å³è‚©é”® (RB)` / `å·¦è‚©é”® (LB)` |
| **å¤¹çˆªæ§åˆ¶** | |
| å¼ å¼€å¤¹çˆª | `Y` é”® |
| é—­åˆå¤¹çˆª | `X` é”® |
| **ç¨‹åºæ§åˆ¶** | |
| æš‚åœ/æ¢å¤æœºå™¨äººè¿åŠ¨ | `A` é”® / `B` é”® |
| **å¼€å§‹** æ•°æ®å½•åˆ¶ | `Start` é”® |
| **ç»“æŸ** å¹¶ **ä¿å­˜** æ•°æ® | `Back` é”® |
| å®‰å…¨é€€å‡ºç¨‹åº | åœ¨ç»ˆç«¯æŒ‰ `Ctrl + C` |

## ğŸ“ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ camera_control/
â”‚   â”‚   â”œâ”€â”€ realsense_handler.py
â”‚   â”‚   â””â”€â”€ zed_handler.py
â”‚   â”œâ”€â”€ data_collection/
â”‚   â”‚   â””â”€â”€ recorder.py
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ ur5_control/
â”‚   â”‚   â””â”€â”€ ur5_controller.py
â”‚   â””â”€â”€ xbox/
â”‚       â””â”€â”€ xbox_control.py
â”œâ”€â”€ robot_dataset/
â”‚   â””â”€â”€ session_YYYYMMDD_HHMMSS/
â”‚       â”œâ”€â”€ robot_state.npy
â”‚       â”œâ”€â”€ d435_color/
â”‚       â”œâ”€â”€ d435_depth/
â”‚       â””â”€â”€ zed_color/
â””â”€â”€ README.md
```

## ğŸ“Š è¾“å‡ºæ•°æ®æ ¼å¼

æ¯æ¬¡æˆåŠŸå½•åˆ¶åï¼Œæ•°æ®ä¼šä¿å­˜åœ¨ `robot_dataset` æ–‡ä»¶å¤¹ä¸‹çš„ä¸€ä¸ªä»¥ä¼šè¯å¼€å§‹æ—¶é—´å‘½åçš„æ–‡ä»¶å¤¹ä¸­ã€‚

- **`robot_state.npy`**
  - è¿™æ˜¯ä¸€ä¸ªNumPyæ•°ç»„ï¼Œç»´åº¦ä¸º `(N, 7)`ï¼Œå…¶ä¸­ `N` æ˜¯é‡‡é›†çš„æ€»å¸§æ•°ã€‚
  - æ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªæ—¶é—´æˆ³ä¸‹çš„æœºå™¨äººçŠ¶æ€ï¼Œ7ä¸ªç»´åº¦çš„å«ä¹‰åˆ†åˆ«æ˜¯ï¼š
    1.  `tcp_x`: TCPä½ç½®X (ç±³)
    2.  `tcp_y`: TCPä½ç½®Y (ç±³)
    3.  `tcp_z`: TCPä½ç½®Z (ç±³)
    4.  `tcp_rx`: TCPå§¿æ€Rx (è½´è§’å¼, å¼§åº¦)
    5.  `tcp_ry`: TCPå§¿æ€Ry (è½´è§’å¼, å¼§åº¦)
    6.  `tcp_rz`: TCPå§¿æ€Rz (è½´è§’å¼, å¼§åº¦)
    7.  `gripper_state`: å¤¹çˆªçŠ¶æ€ (1ä»£è¡¨å¼ å¼€, 0ä»£è¡¨é—­åˆ)

- **å›¾åƒæ–‡ä»¶å¤¹**
  - `d435_color/`, `d435_depth/`, `zed_color/`
  - æ–‡ä»¶å¤¹å†…å­˜æ”¾ç€å¯¹åº”æ•°æ®æµçš„å›¾åƒï¼Œå‡ä¸º `.png` æ ¼å¼ã€‚
  - æ–‡ä»¶åä»¥Unixæ—¶é—´æˆ³å‘½åï¼ˆå¦‚ `1722984590.1234.png`ï¼‰ï¼Œå¯ç”¨äºå’Œ `robot_state.npy` ä¸­çš„æ•°æ®è¿›è¡Œç²¾ç¡®çš„æ—¶é—´å¯¹é½ã€‚

## ğŸ“ æ³¨æ„äº‹é¡¹
- **æ·±åº¦å›¾æŸ¥çœ‹**ï¼šä¿å­˜çš„ `d435_depth` å›¾åƒæ˜¯16ä½çš„åŸå§‹æ·±åº¦æ•°æ®ï¼Œç”¨æ™®é€šçœ‹å›¾è½¯ä»¶æ‰“å¼€ä¼šæ˜¾ç¤ºä¸º**å…¨é»‘**ã€‚è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œå› ä¸ºå®ƒå­˜å‚¨çš„æ˜¯è·ç¦»ï¼ˆå•ä½ï¼šæ¯«ç±³ï¼‰è€Œéé¢œè‰²ã€‚è¯·åœ¨Pythonè„šæœ¬ä¸­ä½¿ç”¨ `cv2.imread(path, cv2.IMREAD_UNCHANGED)` æ¥è¯»å–ï¼Œä»¥è·å–çœŸå®çš„æ·±åº¦å€¼ã€‚
- **ç¨‹åºé€€å‡º**ï¼šå¦‚æœåœ¨å½•åˆ¶è¿‡ç¨‹ä¸­ä½¿ç”¨ `Ctrl+C` å¼ºè¡Œé€€å‡ºç¨‹åºï¼Œç¨‹åºä¼šå°è¯•è‡ªåŠ¨ä¿å­˜å½“å‰å·²é‡‡é›†çš„æ•°æ®ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚